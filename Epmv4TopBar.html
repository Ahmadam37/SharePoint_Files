<!DOCTYPE html>
<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>
  <style>
    @font-face {
      font-family: 'DINNextLTArabic-Regular';
      src: url('../siteassets/fonts/DINNextLTArabic-Regular.eot');
      src: url('../siteassets/fonts/DINNextLTArabic-Regular.eot?#iefix') format('embedded-opentype'),
        url('../siteassets/fonts/DINNextLTArabic-Regular.svg#DINNextLTArabic-Regular') format('svg'),
        url('../siteassets/fonts/DINNextLTArabic-Regular.ttf') format('truetype'),
        url('../siteassets/fonts/DINNextLTArabic-Regular.woff') format('woff'),
        url('../siteassets/fonts/DINNextLTArabic-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Roboto-Thin';
      src: url('../siteassets/fonts/Roboto-Thin.eot');
      src: url('../siteassets/fonts/Roboto-Thin.eot?#iefix') format('embedded-opentype'),
        url('../siteassets/fonts/Roboto-Thin.svg#Roboto-Thin') format('svg'),
        url('../siteassets/fonts/Roboto-Thin.ttf') format('truetype'),
        url('../siteassets/fonts/Roboto-Thin.woff') format('woff'),
        url('../siteassets/fonts/Roboto-Thin.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    #s4-workspace {
      background-color: rgba(250, 250, 250, 0.85);
    }

    #s4-ribbonrow {
      DISPLAY: none !important;
    }

    #s4-titlerow {
      DISPLAY: none !important;

      /* height: 2px !important; */
    }

    #suiteBarDelta {
      DISPLAY: none !important;
    }

    #O365_NavHeader {
      display: none;
    }

    #DeltaPageStatusBar {
      display: none;
    }

    #titleAreaBox {
      display: none;
    }

    .ms-webpartPage-root {
      border-spacing: 0px !important;
    }

    .ms-webpartzone-cell {
      margin: 0px !important;
    }

    body {
      padding: 0;
      margin: 0;
      font-family: DIN Next LT Arabic !important;
    }


    .top {
      background-color: rgb(255, 255, 255);
      border-bottom: 1px solid #dfdfdf;
      box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0), 0px 0px 0px rgba(0, 0, 0, 0.00);
      z-index: 2;
      overflow: auto;
      height: 75px;
      margin-bottom: 1px;
    }

    .ElmLogo {
      float: left;
      width: 122px;
      height: inherit;
      margin: 0 auto;
      padding: 0px;

    }

    .ElmLogo ul {
      height: inherit;
      width: inherit;
      margin: 0 auto;
      background-color: inherit;
      padding: 0px;
    }

    .ElmLogo ul li {
      display: inline-block;
      width: inherit;
      color: gray;
      cursor: default;
      transition: background 0.1s linear;
      margin: 0 auto;
    }

    .ElmLogo :hover {
      background-color: rgba(240, 240, 240, 0.80);
      border-radius: 2px;
    }

    .ElmLogo ul li a {
      width: inherit;
      height: 60px;
    }

    .ElmLogo ul li a img {
      width: 60px;
      height: 60px;
      margin: 0 auto;
      padding: 10px 0px 0px 25px;
    }

    /*left side div*/

    .Epmv4TopMenu {
      float: left;
      width: 80%;
      height: inherit;
      margin-left: 55px;
    }

    .Epmv4TopMenu .leftDiv {
      float: left;
      height: inherit;
      width: 10%;
      margin: 0px auto;
      padding: 0px;
    }

    .Epmv4TopMenu .leftDiv ul {
      margin: 0px auto;
      list-style: none;
      padding: 0;
      height: inherit;
      background-color: inherit;
    }


    .Epmv4TopMenu .leftDiv ul li {
      display: inline-block;
      height: inherit;
      width: 60px;
      color: gray;
      /* cursor: default; */
      transition: background 0.1s linear;
      margin: 0 auto;
    }

    .Epmv4TopMenu .leftDiv ul li:hover {
      background-color: rgba(240, 240, 240, 0.80);
      border-radius: 2px;
    }

    .Epmv4TopMenu .leftDiv ul li a {
      margin: 20px 0px 0px 0px;
      height: 45px;
      width: 45px;
    }

    .Epmv4TopMenu .leftDiv ul li a img {
      /* padding: 20px 0 0 14px; */
      width: 32px;
      height: 32px;
    }

    /*right side*/
    .Epmv4TopMenu .rightDiv {
      float: right;
      height: inherit;
      width: 30%;
      margin: 0px auto;
      padding: 0px;
    }

    .Epmv4TopMenu .rightDiv ul {
      position: relative;
      text-align: center;
      color: gray;
      cursor: default;
      transition: background 0.1s linear;
      min-width: 200px;
      height: inherit;
      float: right;
      margin: 0 auto;
      padding: 0px;
    }

    .Epmv4TopMenu .rightDiv ul li {
      display: inline-block;
      width: 60px;
      height: inherit;
      color: gray;
      /* cursor: default; */
      transition: background 0.1s linear;
      margin: 0 auto;
    }

    .Epmv4TopMenu .rightDiv ul li:hover {
      background-color: rgba(240, 240, 240, 0.80);
      border-radius: 2px;
    }

    .Epmv4TopMenu .rightDiv ul li a {
      margin: 20px 0px 0px 0px;
      height: 45px;
      width: 45px;
    }

    .Epmv4TopMenu .rightDiv ul li a img {
      /* padding: 18px 0 0 0; */
      width: 32px;
      height: 32px;
      margin: inherit;

    }
  </style>

  <script language="javascript" src="/_layouts/15/SP.RequestExecutor.js" type="text/javascript"></script>
  <script language="javascript" src="/pwa/siteassets/elm-jquery-3.3.1.min.js" type="text/javascript"></script>
  <script language="javascript" type="text/javascript">

    function createNewProject() {
      SP.UI.ModalDialog.ShowPopupDialog(
        "https://k2.elm.sa/runtime/Runtime/Form/Project+Request+Form_2E"
      );
    }

    // This is to ensure that sp.js file is loaded before get security group function.
    ExecuteOrDelayUntilScriptLoaded(getSecurityGroups, 'sp.js');

    _spBodyOnLoadFunctionNames.push("UpdateEpmStyle");


    function getQueryStringParameter(myParam) {
      if (document.URL.indexOf("?") > 0) {
        var params = document.URL.split("?")[1].split("&");

        for (var i = 0; i < params.length; i = i + 1) {
          var singleParam = params[i].split("=");

          if (singleParam[0].toLowerCase() == myParam.toLowerCase())
            return singleParam[1];
        }
      }
    }

    function UpdateEpmStyle() {

      var ribbonBox = document.getElementById("s4-ribbonrow").style.visibility = "hidden";
      //var ribbonBox = document.getElementById("s4-ribbonrow").style.display = "none";

      var suiteBarTop = document.getElementById("suiteBarTop").style.height = "1px";
      var s4titlerow = document.getElementById("s4-titlerow").style.height = "1px";
      var s4titlerow = document.getElementById("s4-titlerow").style.paddingTop = "1px";
      var s4titlerow = document.getElementById("s4-titlerow").style.paddingBottom = "1px";
      //#contentRow
      var contentRow = document.getElementById("contentRow").style.paddingTop = "1px";
      var contentRow = document.getElementById("contentRow").style.backgroundColor = "#fafafa";

      //#contentBox
      var contentBox = document.getElementById("contentBox").style.marginLeft = "0px";
      var contentBox = document.getElementById("contentBox").style.marginRight = "0px";

      //#sideNavBox  
      var sideNavBox = document.getElementById("sideNavBox").style.display = "none";

    }

    var oWebSite;
    var clientContex;
    var currentUser;
    var users;
    var pmoGroup;

    function getSecurityGroups() {
      var siteUrl = document.URL;

      clientContext = new SP.ClientContext.get_current();
      oWebSite = clientContext.get_web();
      //var clientContext = new SP.ClientContext(siteUrl);
      //    oWebSite = clientContext.get_web();
      clientContext.load(oWebSite);
      clientContext.executeQueryAsync(success, failure);
    }

    function success() {
      groupsCollection = oWebSite.get_siteGroups();

      var group = '';


      pmoGroup = groupsCollection.getByName('PMO Team');

      clientContext.load(pmoGroup);

      users = pmoGroup.get_users();

      clientContext.load(users);

      currentUser = oWebSite.get_currentUser();

      clientContext.load(currentUser);

      clientContext.executeQueryAsync(usersSuccess, usersFailure);
    }


    function failure() {

      console.log("Function failed" + this.oWebSite.args.get_message() + '\n' + args.get_stackTrace());

    }

    function usersSuccess() {
      console.log('success with groups and users');

      var currentUserEmail = currentUser.get_email();

      var enumerator = users.getEnumerator();

      while (enumerator.moveNext()) {

        var oUser = enumerator.get_current();

        if (oUser.get_email() == currentUserEmail) {
          document.getElementById("K2Settings").style.visibility = "visible";
          console.log("user is in PMO Group, set the the button to visible");
        }

      }

    }

    function usersFailure() {
      console.log("Function failed" + this.oWebSite.args.get_message() + '\n' + args.get_stackTrace());
    }

    // This is for open a popup form for k2 settings
    function openK2Settings() {
      SP.UI.ModalDialog.ShowPopupDialog(
        "https://k2.elm.sa/Designer/Runtime/Form/Form.K2Settings.MenuController/"
      );
    }
    // function openK2Settings() {
    //   SP.UI.ModalDialog.ShowPopupDialog(
    //     {
    //       url: "https://k2dev.elm.sa/Designer/Runtime/Form/Form.K2Settings.MenuController/",
    //       width: 800,
    //       height: 800,
    //       title: "Open K2 Settings"
    //     }
    //   );
    // }

    function openTicketPopup() {
      SP.UI.ModalDialog.ShowPopupDialog(
        "https://k2.elm.sa/Runtime/Runtime/Form/Form.Ticket.Main/"
      );
    }
    function openTicket() {
      SP.UI.ModalDialog.showModalDialog(
        {
          url: "https://k2.elm.sa/Runtime/Runtime/Form/Form.Ticket.Main/",
          width: 800,
          height: 800,
          title: "Open a Ticket for PMO-Tech"
        }
      );
    }

  </script>


  <!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:_dlc_DocId msdt:dt="string">7CP4ZU5533QS-1271-373</mso:_dlc_DocId>
<mso:_dlc_DocIdItemGuid msdt:dt="string">ccdb6df0-71e0-4e1e-8b0a-a8d34b31a385</mso:_dlc_DocIdItemGuid>
<mso:_dlc_DocIdUrl msdt:dt="string">https://epmdev.elm.sa/PWA/_layouts/15/DocIdRedir.aspx?ID=7CP4ZU5533QS-1271-373, 7CP4ZU5533QS-1271-373</mso:_dlc_DocIdUrl>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>

  <div class="top">
    <!-- logo -->
    <div class="ElmLogo">
      <ul>
        <li>
          <a href="https://nahj.elm.sa/PWA/">

            <img src="../SiteAssets/Elm_Small_RGB.png" alt="">
          </a>
        </li>
      </ul>
    </div>

    <div class="Epmv4TopMenu">
      <div class="leftDiv">
        <!-- left side -->
      </div>
      <div class="rightDiv">
        <!-- right side -->
        <ul>
          <li id="K2Settings" class="settings" style="visibility: hidden;">
            <!-- <a href="https://k2.elm.sa/Designer/Runtime/Form/Form.K2Settings.MenuController/" title="K2 Setting"> -->
            <a id="OTickt" onclick="openK2Settings()" title="K2 Settings">
              <img src="../SiteAssets/epmv4/img/puzzle.png" alt="">
            </a>
          </li>

          <li class="settings">
            <a href="https://k2.elm.sa/workspace/" title="K2 Server">

              <img src="../SiteAssets/epmv4/img/k2128.png" lt="">
            </a>
          </li>

          <li class="settings">
            <a id="openT" onclick="openTicket()" title="Open Ticket">
              <img src="../SiteAssets/epmv4/img/support.png" />
              <!-- onmouseover="this.src='SiteAssets/epmv4/img/ticket.png'"
            onmouseout="this.src='SiteAssets/epmv4/img/ticketgrey.png'" alt="">-->
            </a>

          </li>

          <li id="PWASettings" class="settings">
            <a href="../_layouts/15/pwa/Admin/Admin.aspx" title="PWA Server Settings">
              <img src="../SiteAssets/epmv4/img/gearColor128.png" />
              <!-- onmouseover="this.src='SiteAssets/epmv4/img/ticket.png'"
            onmouseout="this.src='SiteAssets/epmv4/img/ticketgrey.png'" alt="">-->
            </a>

          </li>
        </ul>
      </div>

    </div>
  </div>

</body>

</html>